<!DOCTYPE html>
<html lang="en" x-data>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoFinds – Sustainable Marketplace (Prototype)</title>
  <meta name="description" content="EcoFinds prototype with auth, product CRUD, browsing with search & category filter, cart, previous purchases, and user dashboard – all client-side with localStorage." />
  <!-- Tailwind via CDN (for fast prototyping) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #059669; /* emerald-600 */
      --primary-dark: #047857; /* emerald-700 */
      --accent: #FBBF24; /* amber-400 */
    }
    html, body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .hero-bg { background: linear-gradient(rgba(4,120,87,.85), rgba(5,150,105,.85)), url('https://images.unsplash.com/photo-1466611653911-95081537e5b7?q=80&w=1920&auto=format&fit=crop') center/cover; }
    .input { @apply w-full rounded-xl border border-gray-300 px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-emerald-500; }
    .btn { @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold transition; }
    .btn-primary { @apply bg-emerald-600 text-white hover:bg-emerald-700; }
    .btn-outline { @apply border border-emerald-600 text-emerald-700 hover:bg-emerald-50; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900" x-data="ecoFindsApp()" x-init="init()">
  <!-- Header -->
  <header class="bg-white/90 backdrop-blur border-b sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-xl bg-emerald-600 text-white grid place-items-center font-extrabold">E</div>
        <a href="#" @click.prevent="navigate('home')" class="text-xl sm:text-2xl font-extrabold tracking-tight">EcoFinds</a>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
        <a href="#" @click.prevent="navigate('home')" :class="navClass('home')">Home</a>
        <a href="#" @click.prevent="navigate('browse')" :class="navClass('browse')">Browse</a>
        <a href="#" @click.prevent="navigate('mylistings')" :class="navClass('mylistings')">My Listings</a>
        <a href="#" @click.prevent="navigate('add')" :class="navClass('add')">Add Product</a>
        <a href="#" @click.prevent="navigate('purchases')" :class="navClass('purchases')">Previous Purchases</a>
        <a href="#" @click.prevent="navigate('dashboard')" :class="navClass('dashboard')">Dashboard</a>
      </nav>
      <div class="flex items-center gap-3">
        <!-- Cart button -->
        <button class="relative btn btn-outline !px-3 !py-2" @click="cartOpen=true">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293A1 1 0 005 17h12m-1 4a1 1 0 100-2 1 1 0 000 2zm-8 0a1 1 0 100-2 1 1 0 000 2z"/></svg>
          <span class="absolute -top-1 -right-1 bg-emerald-600 text-white text-[10px] w-5 h-5 grid place-items-center rounded-full" x-text="cartCount()"></span>
        </button>
        <!-- Auth -->
        <template x-if="!state.user">
          <button class="btn btn-primary" @click="openAuth('login')">Login / Sign up</button>
        </template>
        <template x-if="state.user">
          <div class="flex items-center gap-2">
            <div class="hidden sm:block text-sm text-gray-600">Hi, <span class="font-semibold" x-text="state.user.username"></span></div>
            <button class="btn btn-outline" @click="logout()">Logout</button>
          </div>
        </template>
      </div>
    </div>
  </header>

  <!-- Main Content Router -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
    <!-- HOME / HERO -->
    <section x-show="route==='home'" x-transition>
      <div class="hero-bg rounded-3xl p-10 sm:p-16 text-white">
        <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight">Discover & List Sustainable Products</h1>
        <p class="mt-4 text-white/90 max-w-2xl">EcoFinds lets you register, list eco-friendly products, browse with search & category filters, add to cart, and track previous purchases — all in one place.</p>
        <div class="mt-8 flex flex-wrap gap-3">
          <button class="btn btn-primary" @click="navigate('browse')">Browse Products</button>
          <button class="btn btn-outline" @click="state.user ? navigate('add') : openAuth('signup')">List a Product</button>
        </div>
      </div>
      <h2 class="mt-10 text-2xl font-bold">Featured</h2>
      <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="p in sampleProducts.slice(0,3)" :key="p.id">
          <div class="bg-white rounded-2xl shadow p-4 hover:shadow-lg transition">
            <div class="relative">
              <img :src="p.image" class="w-full h-44 object-cover rounded-xl" :alt="p.title">
              <span class="absolute top-2 right-2 bg-amber-400 text-gray-900 text-xs font-bold px-2 py-1 rounded">ECO</span>
            </div>
            <div class="mt-3">
              <h3 class="font-semibold" x-text="p.title"></h3>
              <div class="flex items-center justify-between mt-1">
                <span class="text-gray-500 text-sm" x-text="p.category"></span>
                <span class="font-bold" x-text="price(p.price)"></span>
              </div>
              <div class="mt-3 flex gap-2">
                <button class="btn btn-outline w-full" @click="openDetail(p)">Details</button>
                <button class="btn btn-primary w-full" @click="addToCart(p)">Add</button>
              </div>
            </div>
          </div>
        </template>
      </div>
    </section>

    <!-- BROWSE / FEED with Search + Filter -->
    <section x-show="route==='browse'" x-transition>
      <div class="flex flex-col sm:flex-row sm:items-end gap-3">
        <div class="flex-1">
          <label class="text-sm font-semibold">Search</label>
          <input class="input" placeholder="Search by title..." x-model="ui.search">
        </div>
        <div class="w-full sm:w-56">
          <label class="text-sm font-semibold">Category</label>
          <select class="input" x-model="ui.category">
            <option value="">All</option>
            <template x-for="c in categories" :key="c"><option :value="c" x-text="c"></option></template>
          </select>
        </div>
        <button class="btn btn-outline mt-1 sm:mt-0" @click="clearFilters()">Clear</button>
      </div>

      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="p in filteredProducts()" :key="p.id">
          <div class="bg-white rounded-2xl shadow p-4 hover:shadow-lg transition">
            <img :src="p.image" class="w-full h-44 object-cover rounded-xl" :alt="p.title">
            <div class="mt-3">
              <h3 class="font-semibold truncate" x-text="p.title"></h3>
              <p class="text-gray-500 text-sm truncate" x-text="p.description"></p>
              <div class="flex items-center justify-between mt-2">
                <span class="text-gray-500 text-sm" x-text="p.category"></span>
                <span class="font-bold" x-text="price(p.price)"></span>
              </div>
              <div class="mt-3 flex gap-2">
                <button class="btn btn-outline w-full" @click="openDetail(p)">View</button>
                <button class="btn btn-primary w-full" @click="addToCart(p)">Add to Cart</button>
              </div>
            </div>
          </div>
        </template>
      </div>
    </section>

    <!-- ADD PRODUCT -->
    <section x-show="route==='add'" x-transition>
      <div class="bg-white rounded-2xl shadow p-6 max-w-2xl">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl font-bold">Add New Product</h2>
          <span class="text-xs text-gray-500">Owner: <span class="font-semibold" x-text="state.user? state.user.username : 'Login required'"></span></span>
        </div>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-semibold">Product Title</label>
            <input class="input" x-model.trim="form.title" placeholder="e.g., Reusable Bottle">
          </div>
          <div>
            <label class="text-sm font-semibold">Category</label>
            <select class="input" x-model="form.category">
              <option value="">Select category</option>
              <template x-for="c in categories" :key="c"><option :value="c" x-text="c"></option></template>
            </select>
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm font-semibold">Description</label>
            <textarea class="input" rows="3" x-model.trim="form.description" placeholder="Brief, eco-focused description..."></textarea>
          </div>
          <div>
            <label class="text-sm font-semibold">Price (₹)</label>
            <input class="input" type="number" min="0" step="1" x-model.number="form.price" placeholder="499" />
          </div>
          <div>
            <label class="text-sm font-semibold">Image (URL or leave blank)</label>
            <input class="input" x-model.trim="form.image" placeholder="https://..." />
            <p class="text-xs text-gray-500 mt-1">If blank, a placeholder will be used.</p>
          </div>
        </div>
        <div class="mt-6 flex gap-3">
          <button class="btn btn-primary" @click="saveProduct()" x-text="form.id ? 'Update Listing' : 'Submit Listing'"></button>
          <button class="btn btn-outline" @click="resetForm()">Clear</button>
        </div>
      </div>
    </section>

    <!-- MY LISTINGS (CRUD) -->
    <section x-show="route==='mylistings'" x-transition>
      <div class="flex items-center justify-between">
        <h2 class="text-2xl font-bold">My Listings</h2>
        <button class="btn btn-primary" @click="navigate('add')">+ Add Product</button>
      </div>
      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="p in myListings()" :key="p.id">
          <div class="bg-white rounded-2xl shadow p-4">
            <img :src="p.image" class="w-full h-44 object-cover rounded-xl" :alt="p.title">
            <h3 class="mt-3 font-semibold" x-text="p.title"></h3>
            <div class="flex items-center justify-between text-sm mt-1">
              <span class="text-gray-500" x-text="p.category"></span>
              <span class="font-bold" x-text="price(p.price)"></span>
            </div>
            <div class="mt-3 flex gap-2">
              <button class="btn btn-outline w-full" @click="editProduct(p)">Edit</button>
              <button class="btn bg-red-500 text-white hover:bg-red-600 w-full" @click="deleteProduct(p.id)">Delete</button>
            </div>
          </div>
        </template>
      </div>
      <p class="text-gray-500 mt-6" x-show="myListings().length===0">No listings yet. Create one from <button class="text-emerald-700 underline" @click="navigate('add')">Add Product</button>.</p>
    </section>

    <!-- PREVIOUS PURCHASES -->
    <section x-show="route==='purchases'" x-transition>
      <h2 class="text-2xl font-bold">Previous Purchases</h2>
      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="o in state.purchases" :key="o.id">
          <div class="bg-white rounded-2xl shadow p-4">
            <div class="flex items-center justify-between text-sm text-gray-500">
              <span x-text="new Date(o.date).toLocaleString()"></span>
              <span x-text="o.items.length + ' item(s)'"></span>
            </div>
            <div class="mt-3 space-y-2">
              <template x-for="it in o.items" :key="it.id">
                <div class="flex gap-3 items-center">
                  <img :src="it.image" class="w-14 h-14 object-cover rounded-lg" :alt="it.title">
                  <div class="flex-1">
                    <div class="font-medium" x-text="it.title"></div>
                    <div class="text-sm text-gray-500" x-text="it.category"></div>
                  </div>
                  <div class="font-semibold" x-text="price(it.price * it.quantity)"></div>
                </div>
              </template>
            </div>
            <div class="mt-3 border-t pt-3 flex items-center justify-between">
              <div class="text-sm text-gray-600">Order Total</div>
              <div class="font-bold" x-text="price(o.total)"></div>
            </div>
          </div>
        </template>
      </div>
      <p class="text-gray-500 mt-6" x-show="state.purchases.length===0">No purchases yet. Add items to cart and checkout.</p>
    </section>

    <!-- DASHBOARD -->
    <section x-show="route==='dashboard'" x-transition>
      <div class="bg-white rounded-2xl shadow p-6 max-w-2xl">
        <h2 class="text-2xl font-bold">User Dashboard</h2>
        <p class="text-sm text-gray-500">Edit your profile information.</p>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="text-sm font-semibold">Username</label>
            <input class="input" x-model.trim="state.userDraft.username" />
          </div>
          <div>
            <label class="text-sm font-semibold">Email</label>
            <input class="input" type="email" x-model.trim="state.userDraft.email" />
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm font-semibold">Password</label>
            <input class="input" type="password" x-model.trim="state.userDraft.password" />
          </div>
        </div>
        <div class="mt-6 flex gap-3">
          <button class="btn btn-primary" @click="saveProfile()">Save Changes</button>
          <button class="btn btn-outline" @click="resetProfileDraft()">Reset</button>
        </div>
      </div>
    </section>
  </main>

  <!-- PRODUCT DETAIL MODAL -->
  <div x-show="detailOpen" x-transition class="fixed inset-0 bg-black/50 z-50 grid place-items-center p-4" style="display:none">
    <div class="bg-white rounded-2xl shadow-xl max-w-2xl w-full overflow-hidden">
      <div class="flex items-center justify-between p-4 border-b">
        <h3 class="text-xl font-bold" x-text="detail?.title"></h3>
        <button class="btn btn-outline !px-3 !py-1.5" @click="detailOpen=false">Close</button>
      </div>
      <div class="grid md:grid-cols-2 gap-0">
        <img :src="detail?.image" class="w-full h-64 md:h-full object-cover" :alt="detail?.title">
        <div class="p-5">
          <div class="text-sm text-gray-500" x-text="detail?.category"></div>
          <div class="text-2xl font-extrabold mt-1" x-text="price(detail?.price||0)"></div>
          <p class="mt-3 text-gray-700" x-text="detail?.description"></p>
          <div class="mt-5 flex gap-3">
            <button class="btn btn-primary w-full" @click="addToCart(detail)">Add to Cart</button>
            <button class="btn btn-outline w-full" @click="detailOpen=false">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CART SIDEBAR -->
  <div x-show="cartOpen" class="fixed inset-0 z-50" style="display:none">
    <div class="absolute inset-0 bg-black/40" @click="cartOpen=false"></div>
    <aside class="absolute right-0 top-0 h-full w-full sm:w-[420px] bg-white shadow-xl p-5 flex flex-col">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-bold">Your Cart</h3>
        <button class="btn btn-outline !px-3 !py-1.5" @click="cartOpen=false">Close</button>
      </div>
      <div class="mt-4 flex-1 overflow-y-auto divide-y" x-show="state.cart.length">
        <template x-for="it in state.cart" :key="it.id">
          <div class="py-3 flex gap-3 items-center">
            <img :src="it.image" class="w-16 h-16 rounded-lg object-cover" :alt="it.title">
            <div class="flex-1 min-w-0">
              <div class="font-medium truncate" x-text="it.title"></div>
              <div class="text-sm text-gray-500" x-text="it.category"></div>
              <div class="mt-1 flex items-center gap-2">
                <button class="px-2 py-1 border rounded" @click="decreaseQty(it.id)">-</button>
                <span class="font-semibold" x-text="it.quantity"></span>
                <button class="px-2 py-1 border rounded" @click="increaseQty(it.id)">+</button>
              </div>
            </div>
            <div class="text-right">
              <div class="font-bold" x-text="price(it.price*it.quantity)"></div>
              <button class="text-red-600 text-sm mt-1" @click="removeFromCart(it.id)">Remove</button>
            </div>
          </div>
        </template>
      </div>
      <div class="flex-1 grid place-items-center text-gray-500" x-show="!state.cart.length">Cart is empty</div>
      <div class="pt-4 mt-2 border-t">
        <div class="flex items-center justify-between">
          <div class="text-sm text-gray-600">Subtotal</div>
          <div class="font-extrabold" x-text="price(cartTotal())"></div>
        </div>
        <button class="btn btn-primary w-full mt-3" @click="checkout()">Checkout</button>
      </div>
    </aside>
  </div>

  <!-- AUTH MODAL (Login / Signup) -->
  <div x-show="auth.open" x-transition class="fixed inset-0 bg-black/50 z-50 grid place-items-center p-4" style="display:none">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden">
      <div class="flex items-center justify-between p-4 border-b">
        <h3 class="text-lg font-bold" x-text="auth.mode==='login' ? 'Login' : 'Create Account'"></h3>
        <button class="btn btn-outline !px-3 !py-1.5" @click="auth.open=false">Close</button>
      </div>
      <div class="p-5 space-y-3">
        <template x-if="auth.mode==='signup'">
          <div>
            <label class="text-sm font-semibold">Username</label>
            <input class="input" x-model.trim="auth.form.username" placeholder="Your display name" />
          </div>
        </template>
        <div>
          <label class="text-sm font-semibold">Email</label>
          <input class="input" type="email" x-model.trim="auth.form.email" placeholder="you@example.com" />
        </div>
        <div>
          <label class="text-sm font-semibold">Password</label>
          <input class="input" type="password" x-model.trim="auth.form.password" placeholder="••••••••" />
        </div>
        <p class="text-sm text-red-600" x-text="auth.error"></p>
        <button class="btn btn-primary w-full" @click="authSubmit()" x-text="auth.mode==='login' ? 'Login' : 'Sign up'"></button>
        <p class="text-sm text-center text-gray-600">
          <template x-if="auth.mode==='login'">
            <span>New here? <button class="text-emerald-700 underline" @click="openAuth('signup')">Create an account</button></span>
          </template>
          <template x-if="auth.mode!=='login'">
            <span>Already have an account? <button class="text-emerald-700 underline" @click="openAuth('login')">Login</button></span>
          </template>
        </p>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div x-show="toast.show" x-transition class="fixed bottom-4 right-4 bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-lg" x-text="toast.msg" style="display:none"></div>

  <script>
    function ecoFindsApp() {
      return {
        // ROUTER
        route: 'home',
        navigate(r){ this.route=r; window.scrollTo({top:0, behavior:'smooth'}); },
        navClass(r){ return this.route===r? 'text-emerald-700 font-semibold' : 'text-gray-600 hover:text-emerald-700'; },

        // UI state
        cartOpen:false, detailOpen:false, detail:null,
        ui:{ search:'', category:'' },
        toast:{ show:false, msg:'' },

        // Static categories
        categories:[ 'Kitchen', 'Fashion', 'Personal Care', 'Home & Living' ],

        // Seed products (used once, then stored in localStorage as listings)
        sampleProducts:[
          { id: 101, title:'Reusable Bottle', description:'BPA-free stainless steel bottle for everyday hydration.', category:'Kitchen', price:499, image:'https://images.unsplash.com/photo-1602143407151-7111542de6e8?q=80&w=800&auto=format&fit=crop', owner:null },
          { id: 102, title:'Organic Cotton Bag', description:'Durable tote made from 100% organic cotton.', category:'Fashion', price:299, image:'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?q=80&w=800&auto=format&fit=crop', owner:null },
          { id: 103, title:'Bamboo Toothbrush', description:'Biodegradable handle with soft charcoal bristles.', category:'Personal Care', price:149, image:'https://images.unsplash.com/photo-1512438248247-f0f2a5a8b7f0?q=80&w=800&auto=format&fit=crop', owner:null },
          { id: 104, title:'Reusable Coffee Cup', description:'Insulated cup for hot & cold beverages.', category:'Kitchen', price:399, image:'https://images.unsplash.com/photo-1544787219-7f47ccb76574?q=80&w=800&auto=format&fit=crop', owner:null },
          { id: 105, title:'Hemp Backpack', description:'Stylish backpack made from sustainable hemp fibers.', category:'Fashion', price:899, image:'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?q=80&w=800&auto=format&fit=crop', owner:null },
          { id: 106, title:'Wooden Hairbrush', description:'Natural wooden brush gentle on hair & scalp.', category:'Personal Care', price:249, image:'https://images.unsplash.com/photo-1595345264346-6bc452e45fc3?q=80&w=800&auto=format&fit=crop', owner:null }
        ],

        // Global state persisted to localStorage
        state:{ user:null, userDraft:null, listings:[], cart:[], purchases:[] },

        // Forms
        form:{ id:null, title:'', description:'', category:'', price:'', image:'' },

        // Auth modal
        auth:{ open:false, mode:'login', form:{ username:'', email:'', password:'' }, error:'' },

        // Init
        init(){
          // Load from localStorage
          const LS = (k,d)=> JSON.parse(localStorage.getItem(k) || d);
          this.state.user      = LS('eco_user','null');
          this.state.userDraft = this.state.user ? { ...this.state.user } : null;
          this.state.listings  = LS('eco_listings','null') || [];
          this.state.cart      = LS('eco_cart','null') || [];
          this.state.purchases = LS('eco_orders','null') || [];

          // Seed listings once if empty
          if(!this.state.listings.length){
            this.state.listings = [...this.sampleProducts];
            this.persist('eco_listings', this.state.listings);
          }
        },

        // Helpers
        persist(key, val){ localStorage.setItem(key, JSON.stringify(val)); },
        price(v){ return '₹' + (v||0).toLocaleString('en-IN'); },
        flash(msg){ this.toast.msg=msg; this.toast.show=true; setTimeout(()=>this.toast.show=false, 1800); },

        // AUTH
        openAuth(mode){ this.auth.mode=mode; this.auth.form={username:'',email:'',password:''}; this.auth.error=''; this.auth.open=true; },
        authSubmit(){
          const { mode, form } = this.auth;
          if(!form.email || !form.password || (mode==='signup' && !form.username)){
            this.auth.error = 'Please fill all required fields.'; return;
          }
          if(mode==='signup'){
            // Very simple client-only auth: store the user in localStorage
            const newUser = { id: Date.now(), username: form.username, email: form.email, password: form.password };
            this.state.user = newUser;
            this.state.userDraft = { ...newUser };
            this.persist('eco_user', newUser);
            this.flash('Account created. Welcome to EcoFinds!');
          } else {
            // Login: compare with stored user (single-user prototype)
            const saved = JSON.parse(localStorage.getItem('eco_user') || 'null');
            if(!saved || saved.email !== form.email || saved.password !== form.password){
              this.auth.error = 'Invalid email or password.'; return;
            }
            this.state.user = saved;
            this.state.userDraft = { ...saved };
            this.flash('Logged in successfully.');
          }
          this.auth.open=false;
        },
        logout(){ this.state.user=null; this.state.userDraft=null; localStorage.removeItem('eco_user'); this.flash('Logged out.'); },

        // PROFILE
        resetProfileDraft(){ this.state.userDraft = this.state.user ? { ...this.state.user } : null; },
        saveProfile(){ if(!this.state.userDraft) return; this.state.user = { ...this.state.user, ...this.state.userDraft }; this.persist('eco_user', this.state.user); this.flash('Profile updated.'); },

        // LISTINGS
        placeholderImg(){ return 'https://placehold.co/600x400?text=EcoFinds+Product'; },
        nextId(){ return Math.max(0, ...this.state.listings.map(p=>p.id)) + 1; },
        saveProduct(){
          if(!this.state.user){ this.flash('Login required to add a product.'); this.openAuth('login'); return; }
          const f = this.form;
          if(!f.title || !f.category || !f.price){ this.flash('Title, Category, and Price are required.'); return; }
          const payload = {
            id: f.id || this.nextId(),
            title: f.title,
            description: f.description || 'No description provided.',
            category: f.category,
            price: Number(f.price)||0,
            image: f.image?.trim() || this.placeholderImg(),
            owner: this.state.user.id
          };
          if(f.id){
            // update
            const idx = this.state.listings.findIndex(p=>p.id===f.id && p.owner===this.state.user.id || (!p.owner && f.id>=101 && f.id<=106));
            this.state.listings.splice(idx,1,payload);
            this.flash('Listing updated.');
          } else {
            this.state.listings.unshift(payload);
            this.flash('Listing created.');
          }
          this.persist('eco_listings', this.state.listings);
          this.resetForm();
          this.navigate('mylistings');
        },
        editProduct(p){
          if(!this.state.user || (p.owner && p.owner!==this.state.user.id)){ this.flash('You can only edit your own listings.'); return; }
          this.form = { ...p };
          this.navigate('add');
        },
        deleteProduct(id){
          const p = this.state.listings.find(x=>x.id===id);
          if(!this.state.user || (p.owner && p.owner!==this.state.user.id)){ this.flash('You can only delete your own listings.'); return; }
          this.state.listings = this.state.listings.filter(x=>x.id!==id);
          this.persist('eco_listings', this.state.listings);
          this.flash('Listing deleted.');
        },
        resetForm(){ this.form={ id:null, title:'', description:'', category:'', price:'', image:'' }; },
        myListings(){ if(!this.state.user) return []; return this.state.listings.filter(p=>p.owner===this.state.user.id); },

        // BROWSE helpers
        filteredProducts(){
          const q = this.ui.search.trim().toLowerCase();
          const cat = this.ui.category;
          return this.state.listings.filter(p => {
            const titleMatch = !q || p.title.toLowerCase().includes(q);
            const catMatch = !cat || p.category===cat;
            return titleMatch && catMatch;
          });
        },
        clearFilters(){ this.ui.search=''; this.ui.category=''; },
        openDetail(p){ this.detail = p; this.detailOpen = true; },

        // CART
        addToCart(p){
          const idx = this.state.cart.findIndex(x=>x.id===p.id);
          if(idx>-1) this.state.cart[idx].quantity += 1; else this.state.cart.push({ ...p, quantity:1 });
          this.persist('eco_cart', this.state.cart);
          this.flash('Added to cart');
        },
        removeFromCart(id){ this.state.cart = this.state.cart.filter(x=>x.id!==id); this.persist('eco_cart', this.state.cart); },
        increaseQty(id){ const it=this.state.cart.find(x=>x.id===id); if(it){ it.quantity++; this.persist('eco_cart', this.state.cart);} },
        decreaseQty(id){ const it=this.state.cart.find(x=>x.id===id); if(!it) return; it.quantity--; if(it.quantity<=0) this.removeFromCart(id); else this.persist('eco_cart', this.state.cart); },
        cartTotal(){ return this.state.cart.reduce((s,x)=> s + x.price*x.quantity, 0); },
        cartCount(){ return this.state.cart.reduce((s,x)=> s + x.quantity, 0); },
        checkout(){
          if(!this.state.cart.length){ this.flash('Cart is empty.'); return; }
          const order = { id: Date.now(), date: new Date().toISOString(), items: JSON.parse(JSON.stringify(this.state.cart)), total: this.cartTotal() };
          this.state.purchases.unshift(order);
          this.state.cart = [];
          this.persist('eco_orders', this.state.purchases);
          this.persist('eco_cart', this.state.cart);
          this.cartOpen=false; this.navigate('purchases');
          this.flash('Checkout complete. Thank you!');
        },
      }
    }
  </script>

  <!-- Footer -->
  <footer class="mt-16 border-t">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-10 grid md:grid-cols-4 gap-8 text-sm">
      <div>
        <div class="flex items-center gap-2">
          <div class="h-8 w-8 rounded-xl bg-emerald-600 text-white grid place-items-center font-extrabold">E</div>
          <div class="font-extrabold">EcoFinds</div>
        </div>
        <p class="mt-3 text-gray-600">Your eco-friendly marketplace for sustainable products.</p>
      </div>
      <div>
        <div class="font-bold mb-2">Quick Links</div>
        <ul class="space-y-1 text-gray-600">
          <li><a href="#" @click.prevent="navigate('home')">Home</a></li>
          <li><a href="#" @click.prevent="navigate('browse')">Browse</a></li>
          <li><a href="#" @click.prevent="navigate('add')">Add Product</a></li>
          <li><a href="#" @click.prevent="navigate('dashboard')">Dashboard</a></li>
        </ul>
      </div>
      <div>
        <div class="font-bold mb-2">Categories</div>
        <ul class="space-y-1 text-gray-600">
          <template x-for="c in categories" :key="c"><li x-text="c"></li></template>
        </ul>
      </div>
      <div>
        <div class="font-bold mb-2">Contact</div>
        <div class="text-gray-600">contact@ecofinds.com<br/>+91 98765 43210</div>
      </div>
    </div>
    <div class="text-center text-xs text-gray-500 pb-8">© 2025 EcoFinds. All rights reserved.</div>
  </footer>
</body>
</html>
